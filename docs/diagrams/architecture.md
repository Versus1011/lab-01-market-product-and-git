## Product Choice

**Product name:** Wildberries  
**Link:** <https://www.wildberries.ru/>  
**Short description:** Wildberries — крупнейший в России и странах СНГ онлайн-маркетплейс, предлагающий широкий ассортимент товаров от одежды до электроники, с собственной логистической сетью и системой пунктов выдачи заказов.

## Main components

### Component Diagram

![Wildberries Component Diagram](./diagrams/out/wildberries/component-diagram/Component Diagram.svg)

**PlantUML code:** [architecture-component.puml](./src/wildberries/architecture-component.puml)

### Selected Components

1. **API Gateway**  
   Принимает все входящие HTTP-запросы от веб-приложения и мобильных приложений, выполняет аутентификацию и маршрутизацию к соответствующим внутренним микросервисам.

2. **Catalog Service**  
   Управляет каталогом товаров: хранит информацию о товарах, их описания, цены, остатки на складах, категории и атрибуты. Обеспечивает поиск и фильтрацию товаров.

3. **Cart Service**  
   Управляет корзиной покупок пользователей: позволяет добавлять, удалять товары, изменять количество, рассчитывать предварительную сумму заказа с учетом скидок.

4. **Order Service**  
   Обрабатывает процесс оформления заказа: создает новый заказ, управляет его статусом (создан, оплачен, собран, отправлен, доставлен), координирует взаимодействие между другими сервисами.

5. **Payment Gateway**  
   Интегрируется с внешними платежными системами (банки, электронные кошельки) для безопасной обработки платежей. Проверяет карты, проводит авторизацию и возвращает результат транзакции.

## Data flow

### Sequence Diagram

![Wildberries Sequence Diagram](./diagrams/out/wildberries/architecture-sequence/Sequence Diagram.svg)

**PlantUML code:** [architecture-sequence.puml](./src/wildberries/architecture-sequence.puml)

### Flow Description

**Selected flow:** "Process Order" или "Оформление заказа" (выберите группу действий, которая обычно называется "Checkout" или "Place Order")

**Description:**  
Когда пользователь нажимает кнопку "Оформить заказ", система выполняет следующую последовательность действий:

1. **Order Service** создает новый заказ с предварительным статусом.
2. **Order Service** запрашивает у **Catalog Service** актуальную информацию о товарах (цены, наличие).
3. **Cart Service** предоставляет финальный состав корзины.
4. **Order Service** передает данные о сумме заказа в **Payment Gateway**.
5. **Payment Gateway** перенаправляет пользователя на страницу оплаты внешней платежной системы.
6. После успешной оплаты **Payment Gateway** отправляет вебхук (уведомление) в **Order Service**.
7. **Order Service** обновляет статус заказа на "Оплачен" и отправляет задание в **Logistics Service** на сборку и доставку.
8. **Notification Service** отправляет пользователю email и SMS с подтверждением заказа.

**Взаимодействие компонентов:**

- Order Service ↔ Catalog Service: запрос актуальных цен и наличия товаров
- Order Service ↔ Cart Service: получение финального состава корзины
- Order Service ↔ Payment Gateway: передача данных для оплаты, получение подтверждения
- Order Service → Logistics Service: создание задания на доставку
- Order Service → Notification Service: запрос на отправку уведомлений

## Deployment

### Deployment Diagram

![Wildberries Deployment Diagram](./diagrams/out/wildberries/architecture-deployment/Deployment Diagram.svg)

**PlantUML code:** [architecture-deployment.puml](./src/wildberries/architecture-deployment.puml)

### Deployment Description

Диаграмма показывает, что система Wildberries развернута в гибридной облачной инфраструктуре:

1. **Публичный интернет** (Public Internet): через него пользователи получают доступ к приложению через CDN и балансировщики нагрузки.
2. **Веб-уровень** (Web Tier): балансировщики нагрузки (Load Balancers) распределяют трафик между множеством экземпляров API Gateway.
3. **Сервисный уровень** (Application Tier): микросервисы (Catalog, Cart, Order, Payment и другие) запущены в виде контейнеризированных приложений в частном облаке (Private Cloud), оркестрируемых Kubernetes.
4. **Уровень данных** (Data Tier): различные типы баз данных (PostgreSQL для транзакций, MongoDB для документов, Redis для кэша) развернуты в выделенных кластерах.
5. **Внешние системы** (External Systems): платежные шлюзы, сервисы доставки и SMS-уведомлений находятся за пределами инфраструктуры Wildberries.

## Assumptions

1. **Кэширование данных:** Предполагаю, что для ускорения работы каталога и снижения нагрузки на базы данных используется Redis или аналогичная система кэширования для хранения популярных товаров и результатов поиска.
2. **Масштабируемость:** Предполагаю, что микросервисы на уровне приложения могут горизонтально масштабироваться (запускаться в нескольких экземплярах) для обработки пиковых нагрузок, особенно во время распродаж.
3. **Резервирование данных:** Предполагаю, что базы данных настроены в режиме мастер-реплика для обеспечения отказоустойчивости, с автоматическим переключением при сбоях.

## Open questions

1. **Механизм поиска:** Как именно реализован полнотекстовый поиск по товарам? Используется ли Elasticsearch или собственная поисковая система? Как обрабатываются опечатки и синонимы?
2. **Система рекомендаций:** Как работает система рекомендаций "Похожие товары" и "С этим покупают"? Используются ли алгоритмы машинного обучения, и если да, то как они обучаются и обновляются?
3. **Геораспределение:** Как организована инфраструктура для пользователей из разных стран (Россия, Беларусь, Казахстан и др)? Есть ли региональные дата-центры, и как синхронизируются данные между ними?
4. **Обработка очередей:** Какая система очередей сообщений (Kafka, RabbitMQ, NATS) используется для асинхронного взаимодействия между микросервисами, и как обеспечивается надежность доставки сообщений?
